<html>
	<head>
		<script type="module">
			import * as JJ from "../src/index.js";
			import {Entity, Vector3, Mesh, Shader, Material, RealTimeRenderer, ComponentTypes, Quaternion} from "../src/index.js";

			window["JJ"] = JJ;

			let scene = new Entity({name:"scene"});
			let cube = new Entity({name:"cube"});
			window.cube = cube;
			let cubeMesh = new Mesh();
			cubeMesh.positions = [
				new Vector3(-1,-1,-1),
				new Vector3(-1,-1, 1),
				new Vector3(-1, 1,-1),
				new Vector3(-1, 1, 1),

				new Vector3( 1,-1,-1),
				new Vector3( 1,-1, 1),
				new Vector3( 1, 1,-1),
				new Vector3( 1, 1, 1),

				new Vector3(-1,-1,-1),
				new Vector3(-1,-1, 1),
				new Vector3( 1,-1,-1),
				new Vector3( 1,-1, 1),

				new Vector3(-1, 1,-1),
				new Vector3(-1, 1, 1),
				new Vector3( 1, 1,-1),
				new Vector3( 1, 1, 1),

				new Vector3(-1,-1,-1),
				new Vector3(-1, 1,-1),
				new Vector3( 1,-1,-1),
				new Vector3( 1, 1,-1),

				new Vector3(-1,-1, 1),
				new Vector3(-1, 1, 1),
				new Vector3( 1,-1, 1),
				new Vector3( 1, 1, 1),
			];
			cubeMesh.indices = [0,1,2, 1,2,3,  4,5,6, 5,6,7,  8,9,10, 9,10,11,  12,13,14, 13,14,15,  16,17,18, 17,18,19,  20,21,22, 21,22,23];
			let cubeShader = new Shader(`
				attribute vec4 aVertexPosition;

				uniform mat4 uMvpMatrix;

				varying lowp vec4 vColor;

				void main() {
				  gl_Position = uMvpMatrix * aVertexPosition;
				  vColor = aVertexPosition;
				}
			`,`
				varying lowp vec4 vColor;

				void main() {
					gl_FragColor = vec4(abs(vColor).rgb, 1.0);
				}
			`);
			let cubeMat = new Material(cubeShader);
			cube.addComponent(ComponentTypes.mesh, {mesh: cubeMesh, materials: [cubeMat]});
			scene.add(cube);
			let cam = new Entity({name:"cam"});
			cam.pos.z = -5;
			let camComponent = cam.addComponent(ComponentTypes.camera);
			const renderer = new RealTimeRenderer();
			renderer.init();
			scene.add(cam);
			document.body.appendChild(renderer.canvas);

			function loop(){
				cube.rot = Quaternion.fromAxisAngle(new Vector3(0.2,3.3,-0.8), Date.now() * 0.001);
				renderer.render(camComponent);
				window.requestAnimationFrame(loop);
			}
			loop();
		</script>
	</head>
	<body>
	</body>
</html>
